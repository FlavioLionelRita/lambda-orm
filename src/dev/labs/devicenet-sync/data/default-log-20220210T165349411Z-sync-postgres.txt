CREATE TABLE Devices (id VARCHAR(32) NOT NULL ,name VARCHAR(80) NOT NULL ,type VARCHAR(32) NOT NULL ,brand VARCHAR(32) NOT NULL ,model VARCHAR(32) NOT NULL ,so VARCHAR(80) NOT NULL ,imei VARCHAR(16)  ,imei2 VARCHAR(16)  ,mac VARCHAR(24)  ,macBluetooth VARCHAR(24)  ,ip VARCHAR(24)  ,CONSTRAINT Devices_PK PRIMARY KEY (id),CONSTRAINT Devices_UK UNIQUE (name));
CREATE TABLE Components (id VARCHAR(64) NOT NULL ,name VARCHAR(32) NOT NULL ,type VARCHAR(32) NOT NULL ,brand VARCHAR(32) NOT NULL ,model VARCHAR(32) NOT NULL ,deviceId VARCHAR(32) NOT NULL ,CONSTRAINT Components_PK PRIMARY KEY (id),CONSTRAINT Components_UK UNIQUE (deviceId,name));
CREATE TABLE Positions (id serial,deviceId VARCHAR(32) NOT NULL ,journeyId INTEGER  ,latitude DECIMAL(10,4) NOT NULL ,longitude DECIMAL(10,4) NOT NULL ,altitude DECIMAL(10,4)  ,time TIMESTAMP NOT NULL ,CONSTRAINT Positions_PK PRIMARY KEY (id));
CREATE TABLE Journeys (id serial,deviceId VARCHAR(32) NOT NULL ,startPositionId INTEGER  ,endPositionId INTEGER  ,CONSTRAINT Journeys_PK PRIMARY KEY (id));
CREATE TABLE Files (id VARCHAR(255) NOT NULL ,type VARCHAR(16) NOT NULL ,deviceId VARCHAR(32) NOT NULL ,componentId VARCHAR(32)  ,journeyId INTEGER  ,startPositionId INTEGER  ,endPositionId INTEGER  ,CONSTRAINT Files_PK PRIMARY KEY (id));
CREATE INDEX Positions_time ON Positions (time);
ALTER TABLE Positions ADD CONSTRAINT Positions_device_FK FOREIGN KEY (deviceId) REFERENCES Devices (id);
ALTER TABLE Positions ADD CONSTRAINT Positions_journey_FK FOREIGN KEY (journeyId) REFERENCES Journeys (id);
CREATE INDEX Journeys_deviceId ON Journeys (deviceId);
ALTER TABLE Journeys ADD CONSTRAINT Journeys_device_FK FOREIGN KEY (deviceId) REFERENCES Devices (id);
ALTER TABLE Journeys ADD CONSTRAINT Journeys_startPosition_FK FOREIGN KEY (startPositionId) REFERENCES Positions (id);
ALTER TABLE Journeys ADD CONSTRAINT Journeys_endPosition_FK FOREIGN KEY (endPositionId) REFERENCES Positions (id);
ALTER TABLE Files ADD CONSTRAINT Files_device_FK FOREIGN KEY (deviceId) REFERENCES Devices (id);
ALTER TABLE Files ADD CONSTRAINT Files_journey_FK FOREIGN KEY (journeyId) REFERENCES Journeys (id);
ALTER TABLE Files ADD CONSTRAINT Files_component_FK FOREIGN KEY (componentId) REFERENCES Components (id);
ALTER TABLE Files ADD CONSTRAINT Files_startPosition_FK FOREIGN KEY (startPositionId) REFERENCES Positions (id);
ALTER TABLE Files ADD CONSTRAINT Files_endPosition_FK FOREIGN KEY (endPositionId) REFERENCES Positions (id);