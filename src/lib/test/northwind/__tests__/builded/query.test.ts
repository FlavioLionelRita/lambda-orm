/* eslint-disable no-template-curly-in-string */
import { orm } from '../../../..'
beforeAll(async () => {
	require('dotenv').config({ path: './config/northwind.env' })
	await orm.init('./config/northwind.yaml')
})

describe('query', () => {
	const context = JSON.parse('{}')
	test('normalize', () => {
		expect(orm.normalize('Products.sort(p => p.name)')).toStrictEqual('Products.map(p=>{id:p.id,name:p.name,supplierId:p.supplierId,categoryId:p.categoryId,quantity:p.quantity,price:p.price,inStock:p.inStock,onOrder:p.onOrder,reorderLevel:p.reorderLevel,discontinued:p.discontinued}).sort(p=>asc(p.name))')
		expect(orm.normalize('Products.map(p => p).sort(p => p.id).page(1, 1)')).toStrictEqual('Products.map(p=>{id:p.id,name:p.name,supplierId:p.supplierId,categoryId:p.categoryId,quantity:p.quantity,price:p.price,inStock:p.inStock,onOrder:p.onOrder,reorderLevel:p.reorderLevel,discontinued:p.discontinued}).sort(p=>asc(p.id)).page(1,1)')
		expect(orm.normalize('Products.sort(p => p.id).page(1, 1)')).toStrictEqual('Products.map(p=>{id:p.id,name:p.name,supplierId:p.supplierId,categoryId:p.categoryId,quantity:p.quantity,price:p.price,inStock:p.inStock,onOrder:p.onOrder,reorderLevel:p.reorderLevel,discontinued:p.discontinued}).sort(p=>asc(p.id)).page(1,1)')
		expect(orm.normalize('Products.filter(p => p.id === id).map(p => p).sort(p => p.id)')).toStrictEqual('Products.map(p=>{id:p.id,name:p.name,supplierId:p.supplierId,categoryId:p.categoryId,quantity:p.quantity,price:p.price,inStock:p.inStock,onOrder:p.onOrder,reorderLevel:p.reorderLevel,discontinued:p.discontinued}).filter(p=>(p.id==id)).sort(p=>asc(p.id))')
		expect(orm.normalize('Products.filter(p => p.id === id).sort(p => p.id) ')).toStrictEqual('Products.map(p=>{id:p.id,name:p.name,supplierId:p.supplierId,categoryId:p.categoryId,quantity:p.quantity,price:p.price,inStock:p.inStock,onOrder:p.onOrder,reorderLevel:p.reorderLevel,discontinued:p.discontinued}).filter(p=>(p.id==id)).sort(p=>asc(p.id))')
		expect(orm.normalize('Products.map(p => ({ category: p.category.name })).sort(p => p.category)')).toStrictEqual('Products.map(p=>{category:p.category.name}).sort(p=>asc(p.category))')
		expect(orm.normalize('Products.map(p => ({ name: p.name, category: p.category.name })).sort(p => [p.category, p.name])')).toStrictEqual('Products.map(p=>{name:p.name,category:p.category.name}).sort(p=>[asc(p.category),asc(p.name)])')
		expect(orm.normalize('Products.map(p => ({ category: p.category.name, name: p.name, quantity: p.quantity, inStock: p.inStock })).sort(p => p.name)')).toStrictEqual('Products.map(p=>{category:p.category.name,name:p.name,quantity:p.quantity,inStock:p.inStock}).sort(p=>asc(p.name))')
		expect(orm.normalize('Products.filter(p => p.discontinued !== false).map(p => ({ category: p.category.name, name: p.name, quantity: p.quantity, inStock: p.inStock })).sort(p => [p.category, desc(p.name)])')).toStrictEqual('Products.map(p=>{category:p.category.name,name:p.name,quantity:p.quantity,inStock:p.inStock}).filter(p=>(p.discontinued!=false)).sort(p=>[asc(p.category),desc(p.name)])')
		expect(orm.normalize('Orders.details.filter(p => between(p.order.shippedDate, fromDate, toDate) && p.unitPrice > minValue).map(p => ({ category: p.product.category.name, product: p.product.name, unitPrice: p.unitPrice, quantity: p.quantity }))')).toStrictEqual('Orders.details.map(p=>{category:p.product.category.name,product:p.product.name,unitPrice:p.unitPrice,quantity:p.quantity}).filter(p=>(between(p.order.shippedDate,fromDate,toDate)&&(p.unitPrice>minValue)))')
		expect(orm.normalize('Orders.details.filter(p => between(p.order.shippedDate, fromDate, toDate) && p.unitPrice > minValue).map(p => ({ category: p.product.category.name, product: p.product.name, unitPrice: p.unitPrice, quantity: p.quantity })).sort(p => [p.category, p.product, p.unitPrice, p.quantity]) ')).toStrictEqual('Orders.details.map(p=>{category:p.product.category.name,product:p.product.name,unitPrice:p.unitPrice,quantity:p.quantity}).filter(p=>(between(p.order.shippedDate,fromDate,toDate)&&(p.unitPrice>minValue))).sort(p=>[asc(p.category),asc(p.product),asc(p.unitPrice),asc(p.quantity)])')
		expect(orm.normalize('Products.first(p => p)')).toStrictEqual('Products.map(p=>{id:p.id,name:p.name,supplierId:p.supplierId,categoryId:p.categoryId,quantity:p.quantity,price:p.price,inStock:p.inStock,onOrder:p.onOrder,reorderLevel:p.reorderLevel,discontinued:p.discontinued}).sort(p=>asc(p.id)).page(1,1)')
		expect(orm.normalize('Products.last(p => p)')).toStrictEqual('Products.map(p=>{id:p.id,name:p.name,supplierId:p.supplierId,categoryId:p.categoryId,quantity:p.quantity,price:p.price,inStock:p.inStock,onOrder:p.onOrder,reorderLevel:p.reorderLevel,discontinued:p.discontinued}).sort(p=>desc(p.id)).page(1,1)')
		expect(orm.normalize('Products.first(p => ({ category: p.category.name, name: p.name, quantity: p.quantity, inStock: p.inStock }))')).toStrictEqual('Products.map(p=>{category:p.category.name,name:p.name,quantity:p.quantity,inStock:p.inStock}).sort(p=>asc(p.category)).page(1,1)')
		expect(orm.normalize('Products.filter(p => p.discontinued !== false).last(p => p.id)')).toStrictEqual('Products.map(p=>{id:p.id}).filter(p=>(p.discontinued!=false)).sort(p=>desc(p.id)).page(1,1)')
		expect(orm.normalize('Products.distinct(p => p).sort(p => p.id)')).toStrictEqual('Products.map(p=>distinct({id:p.id,name:p.name,supplierId:p.supplierId,categoryId:p.categoryId,quantity:p.quantity,price:p.price,inStock:p.inStock,onOrder:p.onOrder,reorderLevel:p.reorderLevel,discontinued:p.discontinued})).sort(p=>asc(p.id))')
		expect(orm.normalize('Products.distinct(p => ({ category: p.category.name })).sort(p => p.category)')).toStrictEqual('Products.map(p=>distinct({category:p.category.name})).sort(p=>asc(p.category))')
		expect(orm.normalize('Products.distinct(p => ({ quantity: p.quantity, category: p.category.name })).sort(p => [p.quantity, p.category])')).toStrictEqual('Products.map(p=>distinct({quantity:p.quantity,category:p.category.name})).sort(p=>[asc(p.quantity),asc(p.category)])')
	})
	test('model', () => {
		expect(orm.model('Products.sort(p => p.name)')).toStrictEqual([{'name':'id','type':'integer'},{'name':'name','type':'string'},{'name':'supplierId','type':'integer'},{'name':'categoryId','type':'integer'},{'name':'quantity','type':'string'},{'name':'price','type':'decimal'},{'name':'inStock','type':'decimal'},{'name':'onOrder','type':'decimal'},{'name':'reorderLevel','type':'decimal'},{'name':'discontinued','type':'boolean'}])
		expect(orm.model('Products.map(p => p).sort(p => p.id).page(1, 1)')).toStrictEqual([{'name':'id','type':'integer'},{'name':'name','type':'string'},{'name':'supplierId','type':'integer'},{'name':'categoryId','type':'integer'},{'name':'quantity','type':'string'},{'name':'price','type':'decimal'},{'name':'inStock','type':'decimal'},{'name':'onOrder','type':'decimal'},{'name':'reorderLevel','type':'decimal'},{'name':'discontinued','type':'boolean'}])
		expect(orm.model('Products.sort(p => p.id).page(1, 1)')).toStrictEqual([{'name':'id','type':'integer'},{'name':'name','type':'string'},{'name':'supplierId','type':'integer'},{'name':'categoryId','type':'integer'},{'name':'quantity','type':'string'},{'name':'price','type':'decimal'},{'name':'inStock','type':'decimal'},{'name':'onOrder','type':'decimal'},{'name':'reorderLevel','type':'decimal'},{'name':'discontinued','type':'boolean'}])
		expect(orm.model('Products.filter(p => p.id === id).map(p => p).sort(p => p.id)')).toStrictEqual([{'name':'id','type':'integer'},{'name':'name','type':'string'},{'name':'supplierId','type':'integer'},{'name':'categoryId','type':'integer'},{'name':'quantity','type':'string'},{'name':'price','type':'decimal'},{'name':'inStock','type':'decimal'},{'name':'onOrder','type':'decimal'},{'name':'reorderLevel','type':'decimal'},{'name':'discontinued','type':'boolean'}])
		expect(orm.model('Products.filter(p => p.id === id).sort(p => p.id) ')).toStrictEqual([{'name':'id','type':'integer'},{'name':'name','type':'string'},{'name':'supplierId','type':'integer'},{'name':'categoryId','type':'integer'},{'name':'quantity','type':'string'},{'name':'price','type':'decimal'},{'name':'inStock','type':'decimal'},{'name':'onOrder','type':'decimal'},{'name':'reorderLevel','type':'decimal'},{'name':'discontinued','type':'boolean'}])
		expect(orm.model('Products.map(p => ({ category: p.category.name })).sort(p => p.category)')).toStrictEqual([{'name':'category','type':'string'}])
		expect(orm.model('Products.map(p => ({ name: p.name, category: p.category.name })).sort(p => [p.category, p.name])')).toStrictEqual([{'name':'name','type':'string'},{'name':'category','type':'string'}])
		expect(orm.model('Products.map(p => ({ category: p.category.name, name: p.name, quantity: p.quantity, inStock: p.inStock })).sort(p => p.name)')).toStrictEqual([{'name':'category','type':'string'},{'name':'name','type':'string'},{'name':'quantity','type':'string'},{'name':'inStock','type':'decimal'}])
		expect(orm.model('Products.filter(p => p.discontinued !== false).map(p => ({ category: p.category.name, name: p.name, quantity: p.quantity, inStock: p.inStock })).sort(p => [p.category, desc(p.name)])')).toStrictEqual([{'name':'category','type':'string'},{'name':'name','type':'string'},{'name':'quantity','type':'string'},{'name':'inStock','type':'decimal'}])
		expect(orm.model('Orders.details.filter(p => between(p.order.shippedDate, fromDate, toDate) && p.unitPrice > minValue).map(p => ({ category: p.product.category.name, product: p.product.name, unitPrice: p.unitPrice, quantity: p.quantity }))')).toStrictEqual([{'name':'category','type':'string'},{'name':'product','type':'string'},{'name':'unitPrice','type':'decimal'},{'name':'quantity','type':'decimal'}])
		expect(orm.model('Orders.details.filter(p => between(p.order.shippedDate, fromDate, toDate) && p.unitPrice > minValue).map(p => ({ category: p.product.category.name, product: p.product.name, unitPrice: p.unitPrice, quantity: p.quantity })).sort(p => [p.category, p.product, p.unitPrice, p.quantity]) ')).toStrictEqual([{'name':'category','type':'string'},{'name':'product','type':'string'},{'name':'unitPrice','type':'decimal'},{'name':'quantity','type':'decimal'}])
		expect(orm.model('Products.first(p => p)')).toStrictEqual([{'name':'id','type':'integer'},{'name':'name','type':'string'},{'name':'supplierId','type':'integer'},{'name':'categoryId','type':'integer'},{'name':'quantity','type':'string'},{'name':'price','type':'decimal'},{'name':'inStock','type':'decimal'},{'name':'onOrder','type':'decimal'},{'name':'reorderLevel','type':'decimal'},{'name':'discontinued','type':'boolean'}])
		expect(orm.model('Products.last(p => p)')).toStrictEqual([{'name':'id','type':'integer'},{'name':'name','type':'string'},{'name':'supplierId','type':'integer'},{'name':'categoryId','type':'integer'},{'name':'quantity','type':'string'},{'name':'price','type':'decimal'},{'name':'inStock','type':'decimal'},{'name':'onOrder','type':'decimal'},{'name':'reorderLevel','type':'decimal'},{'name':'discontinued','type':'boolean'}])
		expect(orm.model('Products.first(p => ({ category: p.category.name, name: p.name, quantity: p.quantity, inStock: p.inStock }))')).toStrictEqual([{'name':'category','type':'string'},{'name':'name','type':'string'},{'name':'quantity','type':'string'},{'name':'inStock','type':'decimal'}])
		expect(orm.model('Products.filter(p => p.discontinued !== false).last(p => p.id)')).toStrictEqual([{'name':'id','type':'integer'}])
		expect(orm.model('Products.distinct(p => p).sort(p => p.id)')).toStrictEqual([{'name':'id','type':'integer'},{'name':'name','type':'string'},{'name':'supplierId','type':'integer'},{'name':'categoryId','type':'integer'},{'name':'quantity','type':'string'},{'name':'price','type':'decimal'},{'name':'inStock','type':'decimal'},{'name':'onOrder','type':'decimal'},{'name':'reorderLevel','type':'decimal'},{'name':'discontinued','type':'boolean'}])
		expect(orm.model('Products.distinct(p => ({ category: p.category.name })).sort(p => p.category)')).toStrictEqual([{'name':'category','type':'string'}])
		expect(orm.model('Products.distinct(p => ({ quantity: p.quantity, category: p.category.name })).sort(p => [p.quantity, p.category])')).toStrictEqual([{'name':'quantity','type':'string'},{'name':'category','type':'string'}])
	})
	test('parameters', () => {
		expect(orm.parameters('Products.sort(p => p.name)')).toStrictEqual([])
		expect(orm.parameters('Products.map(p => p).sort(p => p.id).page(1, 1)')).toStrictEqual([])
		expect(orm.parameters('Products.sort(p => p.id).page(1, 1)')).toStrictEqual([])
		expect(orm.parameters('Products.filter(p => p.id === id).map(p => p).sort(p => p.id)')).toStrictEqual([{'name':'id','type':'integer'}])
		expect(orm.parameters('Products.filter(p => p.id === id).sort(p => p.id) ')).toStrictEqual([{'name':'id','type':'integer'}])
		expect(orm.parameters('Products.map(p => ({ category: p.category.name })).sort(p => p.category)')).toStrictEqual([])
		expect(orm.parameters('Products.map(p => ({ name: p.name, category: p.category.name })).sort(p => [p.category, p.name])')).toStrictEqual([])
		expect(orm.parameters('Products.map(p => ({ category: p.category.name, name: p.name, quantity: p.quantity, inStock: p.inStock })).sort(p => p.name)')).toStrictEqual([])
		expect(orm.parameters('Products.filter(p => p.discontinued !== false).map(p => ({ category: p.category.name, name: p.name, quantity: p.quantity, inStock: p.inStock })).sort(p => [p.category, desc(p.name)])')).toStrictEqual([])
		expect(orm.parameters('Orders.details.filter(p => between(p.order.shippedDate, fromDate, toDate) && p.unitPrice > minValue).map(p => ({ category: p.product.category.name, product: p.product.name, unitPrice: p.unitPrice, quantity: p.quantity }))')).toStrictEqual([{'name':'fromDate','type':'date'},{'name':'toDate','type':'date'},{'name':'minValue','type':'decimal'}])
		expect(orm.parameters('Orders.details.filter(p => between(p.order.shippedDate, fromDate, toDate) && p.unitPrice > minValue).map(p => ({ category: p.product.category.name, product: p.product.name, unitPrice: p.unitPrice, quantity: p.quantity })).sort(p => [p.category, p.product, p.unitPrice, p.quantity]) ')).toStrictEqual([{'name':'fromDate','type':'date'},{'name':'toDate','type':'date'},{'name':'minValue','type':'decimal'}])
		expect(orm.parameters('Products.first(p => p)')).toStrictEqual([])
		expect(orm.parameters('Products.last(p => p)')).toStrictEqual([])
		expect(orm.parameters('Products.first(p => ({ category: p.category.name, name: p.name, quantity: p.quantity, inStock: p.inStock }))')).toStrictEqual([])
		expect(orm.parameters('Products.filter(p => p.discontinued !== false).last(p => p.id)')).toStrictEqual([])
		expect(orm.parameters('Products.distinct(p => p).sort(p => p.id)')).toStrictEqual([])
		expect(orm.parameters('Products.distinct(p => ({ category: p.category.name })).sort(p => p.category)')).toStrictEqual([])
		expect(orm.parameters('Products.distinct(p => ({ quantity: p.quantity, category: p.category.name })).sort(p => [p.quantity, p.category])')).toStrictEqual([])
	})
	test('constraints', () => {
		expect(orm.constraints('Products.sort(p => p.name)')).toStrictEqual({"entity":"Products","constraints":[]})
		expect(orm.constraints('Products.map(p => p).sort(p => p.id).page(1, 1)')).toStrictEqual({"entity":"Products","constraints":[]})
		expect(orm.constraints('Products.sort(p => p.id).page(1, 1)')).toStrictEqual({"entity":"Products","constraints":[]})
		expect(orm.constraints('Products.filter(p => p.id === id).map(p => p).sort(p => p.id)')).toStrictEqual({"entity":"Products","constraints":[]})
		expect(orm.constraints('Products.filter(p => p.id === id).sort(p => p.id) ')).toStrictEqual({"entity":"Products","constraints":[]})
		expect(orm.constraints('Products.map(p => ({ category: p.category.name })).sort(p => p.category)')).toStrictEqual({"entity":"Products","constraints":[]})
		expect(orm.constraints('Products.map(p => ({ name: p.name, category: p.category.name })).sort(p => [p.category, p.name])')).toStrictEqual({"entity":"Products","constraints":[]})
		expect(orm.constraints('Products.map(p => ({ category: p.category.name, name: p.name, quantity: p.quantity, inStock: p.inStock })).sort(p => p.name)')).toStrictEqual({"entity":"Products","constraints":[]})
		expect(orm.constraints('Products.filter(p => p.discontinued !== false).map(p => ({ category: p.category.name, name: p.name, quantity: p.quantity, inStock: p.inStock })).sort(p => [p.category, desc(p.name)])')).toStrictEqual({"entity":"Products","constraints":[]})
		expect(orm.constraints('Orders.details.filter(p => between(p.order.shippedDate, fromDate, toDate) && p.unitPrice > minValue).map(p => ({ category: p.product.category.name, product: p.product.name, unitPrice: p.unitPrice, quantity: p.quantity }))')).toStrictEqual({"entity":"Orders.details","constraints":[]})
		expect(orm.constraints('Orders.details.filter(p => between(p.order.shippedDate, fromDate, toDate) && p.unitPrice > minValue).map(p => ({ category: p.product.category.name, product: p.product.name, unitPrice: p.unitPrice, quantity: p.quantity })).sort(p => [p.category, p.product, p.unitPrice, p.quantity]) ')).toStrictEqual({"entity":"Orders.details","constraints":[]})
		expect(orm.constraints('Products.first(p => p)')).toStrictEqual({"entity":"Products","constraints":[]})
		expect(orm.constraints('Products.last(p => p)')).toStrictEqual({"entity":"Products","constraints":[]})
		expect(orm.constraints('Products.first(p => ({ category: p.category.name, name: p.name, quantity: p.quantity, inStock: p.inStock }))')).toStrictEqual({"entity":"Products","constraints":[]})
		expect(orm.constraints('Products.filter(p => p.discontinued !== false).last(p => p.id)')).toStrictEqual({"entity":"Products","constraints":[]})
		expect(orm.constraints('Products.distinct(p => p).sort(p => p.id)')).toStrictEqual({"entity":"Products","constraints":[]})
		expect(orm.constraints('Products.distinct(p => ({ category: p.category.name })).sort(p => p.category)')).toStrictEqual({"entity":"Products","constraints":[]})
		expect(orm.constraints('Products.distinct(p => ({ quantity: p.quantity, category: p.category.name })).sort(p => [p.quantity, p.category])')).toStrictEqual({"entity":"Products","constraints":[]})
	})
	test('getInfo', () => {
		expect(orm.getInfo('Products.sort(p => p.name)',{ stage: 'MySQL' })).toStrictEqual({"entity":"Products","dialect":"MySQL","source":"MySQL","sentence":"SELECT p.ProductID AS id, p.ProductName AS name, p.SupplierID AS supplierId, p.CategoryID AS categoryId, p.QuantityPerUnit AS quantity, p.UnitPrice AS price, p.UnitsInStock AS inStock, p.UnitsOnOrder AS onOrder, p.ReorderLevel AS reorderLevel, p.Discontinued AS discontinued FROM Products p  ORDER BY p.ProductName asc ","children":[]})
		expect(orm.getInfo('Products.map(p => p).sort(p => p.id).page(1, 1)',{ stage: 'MySQL' })).toStrictEqual({"entity":"Products","dialect":"MySQL","source":"MySQL","sentence":"SELECT p.ProductID AS id, p.ProductName AS name, p.SupplierID AS supplierId, p.CategoryID AS categoryId, p.QuantityPerUnit AS quantity, p.UnitPrice AS price, p.UnitsInStock AS inStock, p.UnitsOnOrder AS onOrder, p.ReorderLevel AS reorderLevel, p.Discontinued AS discontinued FROM Products p  ORDER BY p.ProductID asc  LIMIT 0,1 ","children":[]})
		expect(orm.getInfo('Products.sort(p => p.id).page(1, 1)',{ stage: 'MySQL' })).toStrictEqual({"entity":"Products","dialect":"MySQL","source":"MySQL","sentence":"SELECT p.ProductID AS id, p.ProductName AS name, p.SupplierID AS supplierId, p.CategoryID AS categoryId, p.QuantityPerUnit AS quantity, p.UnitPrice AS price, p.UnitsInStock AS inStock, p.UnitsOnOrder AS onOrder, p.ReorderLevel AS reorderLevel, p.Discontinued AS discontinued FROM Products p  ORDER BY p.ProductID asc  LIMIT 0,1 ","children":[]})
		expect(orm.getInfo('Products.filter(p => p.id === id).map(p => p).sort(p => p.id)',{ stage: 'MySQL' })).toStrictEqual({"entity":"Products","dialect":"MySQL","source":"MySQL","sentence":"SELECT p.ProductID AS id, p.ProductName AS name, p.SupplierID AS supplierId, p.CategoryID AS categoryId, p.QuantityPerUnit AS quantity, p.UnitPrice AS price, p.UnitsInStock AS inStock, p.UnitsOnOrder AS onOrder, p.ReorderLevel AS reorderLevel, p.Discontinued AS discontinued FROM Products p  WHERE p.ProductID = ? ORDER BY p.ProductID asc ","children":[]})
		expect(orm.getInfo('Products.filter(p => p.id === id).sort(p => p.id) ',{ stage: 'MySQL' })).toStrictEqual({"entity":"Products","dialect":"MySQL","source":"MySQL","sentence":"SELECT p.ProductID AS id, p.ProductName AS name, p.SupplierID AS supplierId, p.CategoryID AS categoryId, p.QuantityPerUnit AS quantity, p.UnitPrice AS price, p.UnitsInStock AS inStock, p.UnitsOnOrder AS onOrder, p.ReorderLevel AS reorderLevel, p.Discontinued AS discontinued FROM Products p  WHERE p.ProductID = ? ORDER BY p.ProductID asc ","children":[]})
		expect(orm.getInfo('Products.map(p => ({ category: p.category.name })).sort(p => p.category)',{ stage: 'MySQL' })).toStrictEqual({"entity":"Products","dialect":"MySQL","source":"MySQL","sentence":"SELECT c.CategoryName AS category FROM Products p INNER JOIN Categories c ON c.CategoryID = p.CategoryID ORDER BY category asc ","children":[]})
		expect(orm.getInfo('Products.map(p => ({ name: p.name, category: p.category.name })).sort(p => [p.category, p.name])',{ stage: 'MySQL' })).toStrictEqual({"entity":"Products","dialect":"MySQL","source":"MySQL","sentence":"SELECT p.ProductName AS name, c.CategoryName AS category FROM Products p INNER JOIN Categories c ON c.CategoryID = p.CategoryID ORDER BY category asc, p.ProductName asc ","children":[]})
		expect(orm.getInfo('Products.map(p => ({ category: p.category.name, name: p.name, quantity: p.quantity, inStock: p.inStock })).sort(p => p.name)',{ stage: 'MySQL' })).toStrictEqual({"entity":"Products","dialect":"MySQL","source":"MySQL","sentence":"SELECT c.CategoryName AS category, p.ProductName AS name, p.QuantityPerUnit AS quantity, p.UnitsInStock AS inStock FROM Products p INNER JOIN Categories c ON c.CategoryID = p.CategoryID ORDER BY p.ProductName asc ","children":[]})
		expect(orm.getInfo('Products.filter(p => p.discontinued !== false).map(p => ({ category: p.category.name, name: p.name, quantity: p.quantity, inStock: p.inStock })).sort(p => [p.category, desc(p.name)])',{ stage: 'MySQL' })).toStrictEqual({"entity":"Products","dialect":"MySQL","source":"MySQL","sentence":"SELECT c.CategoryName AS category, p.ProductName AS name, p.QuantityPerUnit AS quantity, p.UnitsInStock AS inStock FROM Products p INNER JOIN Categories c ON c.CategoryID = p.CategoryID WHERE p.Discontinued <> FALSE ORDER BY category asc, p.ProductName desc ","children":[]})
		expect(orm.getInfo('Orders.details.filter(p => between(p.order.shippedDate, fromDate, toDate) && p.unitPrice > minValue).map(p => ({ category: p.product.category.name, product: p.product.name, unitPrice: p.unitPrice, quantity: p.quantity }))',{ stage: 'MySQL' })).toStrictEqual({"entity":"Orders.details","dialect":"MySQL","source":"MySQL","sentence":"SELECT c.CategoryName AS category, p.ProductName AS product, o.UnitPrice AS unitPrice, o.Quantity AS quantity FROM `Order Details` o INNER JOIN Orders o1 ON o1.OrderID = o.OrderID INNER JOIN Products p ON p.ProductID = o.ProductID INNER JOIN Categories c ON c.CategoryID = p.CategoryID WHERE (o1.ShippedDate BETWEEN ? AND ? AND o.UnitPrice > ?) ","children":[]})
		expect(orm.getInfo('Orders.details.filter(p => between(p.order.shippedDate, fromDate, toDate) && p.unitPrice > minValue).map(p => ({ category: p.product.category.name, product: p.product.name, unitPrice: p.unitPrice, quantity: p.quantity })).sort(p => [p.category, p.product, p.unitPrice, p.quantity]) ',{ stage: 'MySQL' })).toStrictEqual({"entity":"Orders.details","dialect":"MySQL","source":"MySQL","sentence":"SELECT c.CategoryName AS category, p.ProductName AS product, o.UnitPrice AS unitPrice, o.Quantity AS quantity FROM `Order Details` o INNER JOIN Orders o1 ON o1.OrderID = o.OrderID INNER JOIN Products p ON p.ProductID = o.ProductID INNER JOIN Categories c ON c.CategoryID = p.CategoryID WHERE (o1.ShippedDate BETWEEN ? AND ? AND o.UnitPrice > ?) ORDER BY category asc, product asc, o.UnitPrice asc, o.Quantity asc ","children":[]})
		expect(orm.getInfo('Products.first(p => p)',{ stage: 'MySQL' })).toStrictEqual({"entity":"Products","dialect":"MySQL","source":"MySQL","sentence":"SELECT p.ProductID AS id, p.ProductName AS name, p.SupplierID AS supplierId, p.CategoryID AS categoryId, p.QuantityPerUnit AS quantity, p.UnitPrice AS price, p.UnitsInStock AS inStock, p.UnitsOnOrder AS onOrder, p.ReorderLevel AS reorderLevel, p.Discontinued AS discontinued FROM Products p  ORDER BY p.ProductID asc  LIMIT 0,1 ","children":[]})
		expect(orm.getInfo('Products.last(p => p)',{ stage: 'MySQL' })).toStrictEqual({"entity":"Products","dialect":"MySQL","source":"MySQL","sentence":"SELECT p.ProductID AS id, p.ProductName AS name, p.SupplierID AS supplierId, p.CategoryID AS categoryId, p.QuantityPerUnit AS quantity, p.UnitPrice AS price, p.UnitsInStock AS inStock, p.UnitsOnOrder AS onOrder, p.ReorderLevel AS reorderLevel, p.Discontinued AS discontinued FROM Products p  ORDER BY p.ProductID desc  LIMIT 0,1 ","children":[]})
		expect(orm.getInfo('Products.first(p => ({ category: p.category.name, name: p.name, quantity: p.quantity, inStock: p.inStock }))',{ stage: 'MySQL' })).toStrictEqual({"entity":"Products","dialect":"MySQL","source":"MySQL","sentence":"SELECT c.CategoryName AS category, p.ProductName AS name, p.QuantityPerUnit AS quantity, p.UnitsInStock AS inStock FROM Products p INNER JOIN Categories c ON c.CategoryID = p.CategoryID ORDER BY category asc  LIMIT 0,1 ","children":[]})
		expect(orm.getInfo('Products.filter(p => p.discontinued !== false).last(p => p.id)',{ stage: 'MySQL' })).toStrictEqual({"entity":"Products","dialect":"MySQL","source":"MySQL","sentence":"SELECT p.ProductID AS id FROM Products p  WHERE p.Discontinued <> FALSE ORDER BY p.ProductID desc  LIMIT 0,1 ","children":[]})
		expect(orm.getInfo('Products.distinct(p => p).sort(p => p.id)',{ stage: 'MySQL' })).toStrictEqual({"entity":"Products","dialect":"MySQL","source":"MySQL","sentence":"SELECT DISTINCT p.ProductID AS id, p.ProductName AS name, p.SupplierID AS supplierId, p.CategoryID AS categoryId, p.QuantityPerUnit AS quantity, p.UnitPrice AS price, p.UnitsInStock AS inStock, p.UnitsOnOrder AS onOrder, p.ReorderLevel AS reorderLevel, p.Discontinued AS discontinued FROM Products p  ORDER BY p.ProductID asc ","children":[]})
		expect(orm.getInfo('Products.distinct(p => ({ category: p.category.name })).sort(p => p.category)',{ stage: 'MySQL' })).toStrictEqual({"entity":"Products","dialect":"MySQL","source":"MySQL","sentence":"SELECT DISTINCT c.CategoryName AS category FROM Products p INNER JOIN Categories c ON c.CategoryID = p.CategoryID ORDER BY category asc ","children":[]})
		expect(orm.getInfo('Products.distinct(p => ({ quantity: p.quantity, category: p.category.name })).sort(p => [p.quantity, p.category])',{ stage: 'MySQL' })).toStrictEqual({"entity":"Products","dialect":"MySQL","source":"MySQL","sentence":"SELECT DISTINCT p.QuantityPerUnit AS quantity, c.CategoryName AS category FROM Products p INNER JOIN Categories c ON c.CategoryID = p.CategoryID ORDER BY p.QuantityPerUnit asc, category asc ","children":[]})
	})
})
